<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DH Finance - Aplikasi Keuangan Pribadi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f0f7ff 0%, #e6f0ff 100%);
            min-height: 100vh;
            padding: 20px;
            color: #1e3a8a;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(30, 58, 138, 0.15);
            overflow: hidden;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
        }

        .loading-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .spinner {
            width: 70px;
            height: 70px;
            border: 6px solid #dbeafe;
            border-top: 6px solid #1d4ed8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 18px;
            font-weight: 600;
            color: #1d4ed8;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #1d4ed8 100%);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #dbeafe;
        }

        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 5px;
        }

        .logo-icon {
            font-size: 32px;
            color: white;
        }

        .user-display {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        .user-name {
            font-size: 22px;
            font-weight: bold;
            color: white;
        }

        /* Auth Section */
        .auth-section {
            padding: 40px;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 600px;
            gap: 40px;
        }

        .auth-container {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }

        .auth-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(30, 58, 138, 0.1);
            width: 100%;
            max-width: 450px;
            border: 2px solid #dbeafe;
        }

        .auth-title {
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 30px;
            color: #1e3a8a;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        input[type="text"],
        input[type="password"],
        input[type="number"],
        input[type="date"],
        input[type="email"],
        input[type="url"],
        select,
        textarea {
            padding: 15px 20px;
            border: 2px solid #dbeafe;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            width: 100%;
            background: white;
            color: #1e3a8a;
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: #3b82f6;
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            background: #f8fafc;
        }

        input::placeholder {
            color: #94a3b8;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(239, 68, 68, 0.3);
        }

        .btn-outline {
            background: white;
            border: 2px solid #3b82f6;
            color: #3b82f6;
            padding: 10px 20px;
            font-size: 14px;
        }

        .btn-outline:hover {
            background: #3b82f6;
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .btn-warning:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(245, 158, 11, 0.3);
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            padding: 30px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Forms */
        .form-section {
            background: #f8fafc;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid #dbeafe;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #1e3a8a;
            font-size: 16px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 1px solid #dbeafe;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #3b82f6;
        }

        .proof-container {
            margin-top: 15px;
            padding: 20px;
            background: rgba(219, 234, 254, 0.5);
            border-radius: 12px;
            border: 2px dashed #3b82f6;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard */
        .dashboard {
            display: grid;
            gap: 30px;
        }

        .balance-card {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e3a8a;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(30, 58, 138, 0.1);
            border: 2px solid #93c5fd;
        }

        .balance-amount {
            font-size: 48px;
            font-weight: bold;
            margin: 15px 0;
            color: #1d4ed8;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.7);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #93c5fd;
        }

        .stat-item:nth-child(1) {
            border-left: 4px solid #10b981;
        }

        .stat-item:nth-child(2) {
            border-left: 4px solid #ef4444;
        }

        /* Transactions */
        .transactions {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid #dbeafe;
        }

        .transaction-list-container {
            max-height: 500px;
            overflow-y: auto;
            margin-top: 20px;
            padding-right: 10px;
        }

        .transaction-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .transaction-list-container::-webkit-scrollbar {
            width: 8px;
        }

        .transaction-list-container::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }

        .transaction-list-container::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .transaction-list-container::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border: 1px solid #dbeafe;
            transition: all 0.3s;
            animation: slideIn 0.5s ease;
            background: white;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            touch-action: pan-y;
            user-select: none;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .transaction-item.dragging {
            transition: transform 0.2s ease;
        }

        .transaction-content {
            flex: 1;
            min-width: 0;
            transition: transform 0.3s ease;
        }

        .transaction-actions {
            position: absolute;
            right: -80px;
            top: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0 20px;
            background: linear-gradient(90deg, transparent, white);
            transition: right 0.3s ease;
        }

        .transaction-item.swiped .transaction-actions {
            right: 0;
        }

        .transaction-item.swiped .transaction-content {
            transform: translateX(-60px);
        }

        .transaction-type {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .type-income {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .type-expense {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        /* Settings */
        .settings {
            background: #f8fafc;
            padding: 30px;
            border-radius: 15px;
            margin: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid #dbeafe;
        }

        .currency-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .currency-item {
            padding: 25px;
            border: 2px solid #dbeafe;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            background: white;
        }

        .currency-item:hover {
            border-color: #3b82f6;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .currency-item.active {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #dbeafe 0%, #93c5fd 100%);
            color: #1e3a8a;
            transform: scale(1.05);
            font-weight: bold;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .section-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 25px;
            color: #1e3a8a;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert {
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            font-weight: 500;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e3a8a;
            border: 1px solid #93c5fd;
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }

        /* Filter Section */
        .filter-section {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .proof-badge {
            padding: 6px 15px;
            background: #dbeafe;
            color: #1e3a8a;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: 1px solid #93c5fd;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .proof-badge:hover {
            background: #bfdbfe;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.2);
        }

        .proof-badge.has-proof {
            background: linear-gradient(135deg, #dbeafe 0%, #93c5fd 100%);
        }

        .proof-badge.no-proof {
            background: #fecaca;
            color: #991b1b;
            border: 1px solid #fca5a5;
            cursor: not-allowed;
        }

        .proof-badge.no-proof:hover {
            background: #fecaca;
            transform: none;
            box-shadow: none;
        }

        /* Welcome Message */
        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #93c5fd;
        }

        .welcome-message h1 {
            font-size: 36px;
            color: #1e3a8a;
            margin-bottom: 15px;
        }

        .welcome-message p {
            font-size: 18px;
            color: #4b5563;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 25px;
            background: #f8fafc;
            color: #64748b;
            font-size: 14px;
            margin-top: 40px;
            border-top: 1px solid #e2e8f0;
        }

        /* Delete Button Animation */
        .delete-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .delete-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
        }

        /* Demo Account Info */
        .demo-info {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background: #dcfce7;
            border-radius: 10px;
            color: #166534;
            font-size: 14px;
            border: 1px solid #bbf7d0;
        }

        /* Transaction Amount */
        .transaction-amount {
            font-size: 24px;
            font-weight: bold;
            text-align: right;
            min-width: 120px;
        }

        .amount-income {
            color: #10b981;
        }

        .amount-expense {
            color: #ef4444;
        }

        /* Header Logo and User */
        .app-name {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            margin-top: 5px;
        }

        .user-details {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        .user-fullname {
            font-size: 22px;
            font-weight: bold;
            color: white;
        }

        .logout-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        /* Proof Link Style */
        .proof-link {
            color: #1e3a8a;
            text-decoration: none;
            font-weight: 600;
        }

        .proof-link:hover {
            text-decoration: underline;
        }

        /* URL Input Style */
        .url-input {
            font-family: monospace;
        }

        /* Export Button */
        .export-btn {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
        }

        .export-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);
        }

        /* Notification System */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .notification {
            padding: 20px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            border-left: 5px solid;
            animation: slideInRight 0.3s ease-out;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.hide {
            transform: translateX(120%);
        }

        @keyframes slideInRight {
            from { transform: translateX(120%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification-success {
            border-left-color: #10b981;
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            color: #065f46;
        }

        .notification-error {
            border-left-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            color: #991b1b;
        }

        .notification-info {
            border-left-color: #3b82f6;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            color: #1e3a8a;
        }

        .notification-warning {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            color: #92400e;
        }

        .notification-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .notification-message {
            font-size: 14px;
            opacity: 0.9;
        }

        .notification-close {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            font-size: 18px;
            opacity: 0.7;
            transition: opacity 0.3s;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .notification-close:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.1);
        }

        /* Enhanced Filter UI */
        .filter-status {
            margin-top: 15px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
            border: 1px solid #dbeafe;
            font-size: 14px;
            color: #64748b;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-active {
            background: #dbeafe;
            color: #1e3a8a;
            font-weight: 600;
        }

        .clear-filter-btn {
            background: none;
            border: none;
            color: #3b82f6;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: 6px;
            transition: all 0.3s;
        }

        .clear-filter-btn:hover {
            background: #e0f2fe;
        }

        /* Delete Confirmation Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10001;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .modal-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .modal-icon {
            font-size: 32px;
            color: #ef4444;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #1e3a8a;
        }

        .modal-content {
            margin-bottom: 25px;
            color: #4b5563;
            line-height: 1.6;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        /* Transaction counter badge */
        .transaction-count-badge {
            display: inline-block;
            background: #3b82f6;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
            vertical-align: middle;
        }

        /* Enhanced UI Elements */
        .form-section h2, .dashboard h2 {
            position: relative;
            padding-bottom: 10px;
        }

        .form-section h2::after, .dashboard h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border-radius: 2px;
        }

        .transaction-item:hover {
            border-color: #93c5fd;
            box-shadow: 0 5px 15px rgba(30, 58, 138, 0.1);
            transform: translateY(-2px);
        }

        .currency-item.selected {
            animation: pulse 0.5s ease;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Empty state styling */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #64748b;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        /* Date filter toggle */
        .filter-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            user-select: none;
        }

        .filter-toggle input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #3b82f6;
        }

        .filter-toggle-label {
            font-weight: 600;
            color: #1e3a8a;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="modal-title">Konfirmasi Hapus</div>
            </div>
            <div class="modal-content">
                Apakah Anda yakin ingin menghapus transaksi ini? Tindakan ini tidak dapat dibatalkan.
                <div id="modalTransactionDetails" style="margin-top: 15px; padding: 15px; background: #f8fafc; border-radius: 10px; font-size: 14px;"></div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-outline" onclick="closeDeleteModal()">
                    <i class="fas fa-times"></i> Batal
                </button>
                <button class="btn btn-danger" onclick="confirmDeleteTransaction()">
                    <i class="fas fa-trash"></i> Hapus
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div class="loading-text" id="loadingText">Memproses...</div>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo-section">
                <div class="logo">
                    <i class="logo-icon fas fa-chart-line"></i>
                    DH Finance
                </div>
                <div class="app-name">Aplikasi Keuangan Pribadi</div>
            </div>
            <div class="logout-section" id="userInfo">
                <div class="user-details">
                    <div class="user-fullname" id="currentUser">Belum Login</div>
                </div>
                <button class="btn btn-outline" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>

        <!-- Authentication Section -->
        <div class="auth-section" id="authSection">
            <div class="welcome-message">
                <h1><i class="fas fa-chart-line"></i> Selamat Datang di DH Finance</h1>
                <p>Kelola keuangan pribadi Anda dengan mudah dan efektif. Lacak pengeluaran, pemasukan, dan rencanakan masa depan keuangan Anda.</p>
            </div>
            
            <div class="auth-container">
                <div class="auth-card">
                    <div class="auth-title">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </div>
                    <div class="auth-form">
                        <input type="text" id="loginUsername" placeholder="Username" required>
                        <input type="password" id="loginPassword" placeholder="Password" required>
                        <button class="btn btn-primary" onclick="login()" id="loginButton">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </button>
                    </div>
                    <div class="demo-info">
                        <i class="fas fa-info-circle"></i> Akun demo: <strong>demo</strong> / <strong>demo123</strong>
                    </div>
                </div>
                
                <div class="auth-card">
                    <div class="auth-title">
                        <i class="fas fa-user-plus"></i> Daftar Akun Baru
                    </div>
                    <div class="auth-form">
                        <input type="text" id="registerUsername" placeholder="Username Baru" required>
                        <input type="email" id="registerEmail" placeholder="Email (opsional)">
                        <input type="password" id="registerPassword" placeholder="Password Baru" required>
                        <button class="btn btn-success" onclick="register()" id="registerButton">
                            <i class="fas fa-user-plus"></i> Daftar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content (Hidden until login) -->
        <div id="mainApp" class="hidden">
            <!-- Main Dashboard -->
            <div class="main-content">
                <!-- Left Column: Forms -->
                <div class="form-section">
                    <h2 class="section-title">
                        <i class="fas fa-plus-circle"></i> Tambah Transaksi Baru
                    </h2>
                    
                    <div class="form-group">
                        <label for="transactionType">Jenis Transaksi</label>
                        <select id="transactionType" class="form-control" onchange="toggleProofField()">
                            <option value="income">Uang Masuk</option>
                            <option value="expense">Uang Keluar</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="amount">Nominal (dalam <span id="currencyLabel">IDR</span>)</label>
                        <input type="number" id="amount" placeholder="Masukkan nominal" required>
                    </div>

                    <div class="form-group">
                        <label for="description">Keterangan Transaksi</label>
                        <textarea id="description" rows="3" placeholder="Deskripsi transaksi..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="transactionDate">Tanggal Transaksi</label>
                        <input type="date" id="transactionDate" required>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="hasProof" onchange="toggleProofField()">
                        <label for="hasProof">Transaksi ini memiliki bukti transfer</label>
                    </div>

                    <div id="proofContainer" class="proof-container hidden">
                        <label for="proofDetails">Link Bukti Transfer (URL)</label>
                        <input type="url" id="proofDetails" class="url-input" placeholder="https://example.com/bukti-transfer.jpg" pattern="https?://.+" title="Masukkan URL lengkap dengan http:// atau https://">
                        <div style="margin-top: 10px; font-size: 14px; color: #64748b;">
                            <i class="fas fa-info-circle"></i> Masukkan URL lengkap bukti transfer (contoh: https://prnt.sc/abc123)
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="addTransaction()" style="width: 100%; padding: 18px;" id="saveTransactionButton">
                        <i class="fas fa-save"></i> Simpan Transaksi
                    </button>

                    <!-- Filter Section -->
                    <div style="margin-top: 40px;">
                        <h2 class="section-title">
                            <i class="fas fa-filter"></i> Filter & Ekspor Transaksi
                        </h2>
                        
                        <div class="filter-toggle">
                            <input type="checkbox" id="enableFilter" onchange="toggleFilterMode()">
                            <label for="enableFilter" class="filter-toggle-label">Aktifkan Filter Tanggal</label>
                        </div>
                        
                        <div class="filter-section" id="filterControls">
                            <input type="date" id="filterDate" style="flex: 1;">
                            <div class="filter-actions">
                                <button class="btn btn-outline" onclick="applyFilter()">
                                    <i class="fas fa-search"></i> Filter
                                </button>
                                <button class="btn btn-outline" onclick="clearFilter()">
                                    <i class="fas fa-redo"></i> Reset
                                </button>
                                <button class="btn btn-warning" onclick="exportToExcel()">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button class="btn export-btn" onclick="exportToWord()">
                                    <i class="fas fa-file-word"></i> Word
                                </button>
                            </div>
                        </div>
                        
                        <div id="filterStatus" class="filter-status hidden">
                            <div>
                                <i class="fas fa-info-circle"></i> 
                                <span id="filterMessage">Menampilkan semua transaksi</span>
                            </div>
                            <button class="clear-filter-btn" onclick="clearFilter()">
                                <i class="fas fa-times"></i> Hapus Filter
                            </button>
                        </div>
                        
                        <div style="margin-top: 15px; font-size: 14px; color: #64748b;">
                            <i class="fas fa-info-circle"></i> Ekspor semua data transaksi ke file Excel atau Word
                        </div>
                    </div>
                </div>

                <!-- Right Column: Dashboard -->
                <div class="dashboard">
                    <!-- Balance Card -->
                    <div class="balance-card">
                        <div style="font-size: 18px; opacity: 0.9;">Saldo Saat Ini</div>
                        <div class="balance-amount" id="currentBalance">0</div>
                        <div style="font-size: 16px; opacity: 0.9;" id="balanceDate">Hari ini</div>
                        
                        <div class="stats">
                            <div class="stat-item">
                                <div style="font-size: 16px; opacity: 0.9;">Total Uang Masuk</div>
                                <div style="font-size: 26px; font-weight: bold;" id="totalIncome">0</div>
                            </div>
                            <div class="stat-item">
                                <div style="font-size: 16px; opacity: 0.9;">Total Uang Keluar</div>
                                <div style="font-size: 26px; font-weight: bold;" id="totalExpense">0</div>
                            </div>
                        </div>
                    </div>

                    <!-- Transactions List -->
                    <div class="transactions">
                        <h2 class="section-title">
                            <i class="fas fa-history"></i> Riwayat Transaksi Terbaru
                            <span class="transaction-count-badge" id="transactionCountBadge">0</span>
                        </h2>
                        
                        <div id="filterStatusMini" class="filter-status" style="display: none;">
                            <div>
                                <i class="fas fa-filter"></i> 
                                <span id="filterMessageMini"></span>
                            </div>
                        </div>
                        
                        <div class="transaction-list-container">
                            <div id="transactionList" class="transaction-list">
                                <!-- Transactions will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Currency Settings Section -->
            <div class="settings">
                <h2 class="section-title">
                    <i class="fas fa-cog"></i> Pengaturan Mata Uang
                </h2>
                <p class="alert alert-info">
                    <i class="fas fa-info-circle"></i> Pilih mata uang yang ingin digunakan. Setiap user memiliki preferensi mata uang sendiri-sendiri.
                </p>
                
                <div class="currency-grid" id="currencyGrid">
                    <!-- Currencies will be loaded here -->
                </div>
            </div>

            <div class="footer">
                <p>&copy; 2024 DH Finance - Aplikasi Manajemen Keuangan Pribadi</p>
                <p style="margin-top: 10px; opacity: 0.8;"><i class="fas fa-user"></i> Login sebagai: <span id="footerUsername">-</span> | Total Transaksi: <span id="footerTransactionCount">0</span></p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('dh_finance_users')) || {};
        let transactions = JSON.parse(localStorage.getItem('dh_finance_transactions')) || {};
        let userSettings = JSON.parse(localStorage.getItem('dh_finance_user_settings')) || {};
        let swipeStartX = 0;
        let swipeEndX = 0;
        let currentSwipeId = null;
        let currentFilter = null;
        let transactionToDelete = null;
        
        // Currency data
        const currencies = {
            'IDR': { symbol: 'Rp', name: 'Rupiah Indonesia' },
            'USD': { symbol: '$', name: 'US Dollar' },
            'EUR': { symbol: '€', name: 'Euro' },
            'GBP': { symbol: '£', name: 'British Pound' },
            'JPY': { symbol: '¥', name: 'Japanese Yen' },
            'SGD': { symbol: 'S$', name: 'Singapore Dollar' },
            'THB': { symbol: '฿', name: 'Baht Thailand' },
            'KHR': { symbol: '៛', name: 'Riel Kamboja' }
        };

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            updateDate();
            checkLoginStatus();
            setupSwipeListeners();
            setupEnterKeyListeners();
            setupFilterControls();
        });

        // Setup Enter key listeners for all forms
        function setupEnterKeyListeners() {
            // Login form Enter key
            document.getElementById('loginPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
            
            document.getElementById('loginUsername').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });

            // Register form Enter key
            document.getElementById('registerPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    register();
                }
            });

            // Transaction form Enter key
            document.getElementById('description').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addTransaction();
                }
            });

            document.getElementById('amount').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addTransaction();
                }
            });

            document.getElementById('proofDetails').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addTransaction();
                }
            });
        }

        // Setup filter controls
        function setupFilterControls() {
            const enableFilter = document.getElementById('enableFilter');
            const filterControls = document.getElementById('filterControls');
            
            enableFilter.addEventListener('change', function() {
                if (this.checked) {
                    filterControls.style.display = 'flex';
                    document.getElementById('filterDate').focus();
                } else {
                    filterControls.style.display = 'none';
                    clearFilter();
                }
            });
            
            // Initialize hidden
            filterControls.style.display = 'none';
        }

        // Setup swipe functionality
        function setupSwipeListeners() {
            document.addEventListener('touchstart', handleTouchStart, false);
            document.addEventListener('touchmove', handleTouchMove, false);
            document.addEventListener('touchend', handleTouchEnd, false);
            
            // For mouse events (desktop testing)
            document.addEventListener('mousedown', handleMouseDown, false);
            document.addEventListener('mousemove', handleMouseMove, false);
            document.addEventListener('mouseup', handleMouseUp, false);
        }

        // Touch event handlers
        function handleTouchStart(e) {
            const transactionItem = e.target.closest('.transaction-item');
            if (transactionItem && !e.target.closest('.proof-badge')) {
                swipeStartX = e.touches[0].clientX;
                currentSwipeId = transactionItem.id;
            }
        }

        function handleTouchMove(e) {
            if (!currentSwipeId) return;
            e.preventDefault();
        }

        function handleTouchEnd(e) {
            if (!currentSwipeId) return;
            
            const transactionItem = document.getElementById(currentSwipeId);
            if (transactionItem) {
                swipeEndX = e.changedTouches[0].clientX;
                const swipeDistance = swipeStartX - swipeEndX;
                
                // Reset all other transaction items
                document.querySelectorAll('.transaction-item.swiped').forEach(item => {
                    if (item.id !== currentSwipeId) {
                        item.classList.remove('swiped');
                    }
                });
                
                // If swipe distance is enough, show delete button
                if (swipeDistance > 50) {
                    transactionItem.classList.add('swiped');
                } else if (swipeDistance < -50) {
                    transactionItem.classList.remove('swiped');
                }
            }
            
            currentSwipeId = null;
            swipeStartX = 0;
            swipeEndX = 0;
        }

        // Mouse event handlers (for desktop)
        function handleMouseDown(e) {
            if (e.button !== 0) return; // Only left click
            
            const transactionItem = e.target.closest('.transaction-item');
            if (transactionItem && !e.target.closest('.proof-badge')) {
                swipeStartX = e.clientX;
                currentSwipeId = transactionItem.id;
                transactionItem.classList.add('dragging');
            }
        }

        function handleMouseMove(e) {
            if (!currentSwipeId) return;
            
            const transactionItem = document.getElementById(currentSwipeId);
            if (transactionItem) {
                swipeEndX = e.clientX;
                const swipeDistance = swipeStartX - swipeEndX;
                
                if (Math.abs(swipeDistance) > 50) {
                    if (swipeDistance > 0) {
                        transactionItem.classList.add('swiped');
                    } else {
                        transactionItem.classList.remove('swiped');
                    }
                }
            }
        }

        function handleMouseUp(e) {
            if (!currentSwipeId) return;
            
            const transactionItem = document.getElementById(currentSwipeId);
            if (transactionItem) {
                transactionItem.classList.remove('dragging');
                
                // Reset all other transaction items
                document.querySelectorAll('.transaction-item.swiped').forEach(item => {
                    if (item.id !== currentSwipeId) {
                        item.classList.remove('swiped');
                    }
                });
            }
            
            currentSwipeId = null;
            swipeStartX = 0;
            swipeEndX = 0;
        }

        // Notification system
        function showNotification(type, title, message, duration = 5000) {
            const container = document.getElementById('notificationContainer');
            const notificationId = 'notification-' + Date.now();
            
            const icons = {
                'success': 'fa-check-circle',
                'error': 'fa-times-circle',
                'info': 'fa-info-circle',
                'warning': 'fa-exclamation-triangle'
            };
            
            const notification = document.createElement('div');
            notification.id = notificationId;
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="fas ${icons[type]}"></i>
                </div>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close" onclick="removeNotification('${notificationId}')">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(notification);
            
            // Show notification with animation
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Auto remove after duration
            if (duration > 0) {
                setTimeout(() => {
                    removeNotification(notificationId);
                }, duration);
            }
            
            return notificationId;
        }

        function removeNotification(id) {
            const notification = document.getElementById(id);
            if (notification) {
                notification.classList.remove('show');
                notification.classList.add('hide');
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }
        }

        // Loading functions
        function showLoading(message = 'Memproses...') {
            document.getElementById('loadingText').textContent = message;
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            setTimeout(() => {
                document.getElementById('loadingOverlay').classList.remove('active');
            }, 500);
        }

        function updateDate() {
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            document.getElementById('transactionDate').value = today;
            document.getElementById('filterDate').value = today;
            document.getElementById('balanceDate').textContent = 
                now.toLocaleDateString('id-ID', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
        }

        // Authentication functions
        function login() {
            showLoading('Melakukan login...');
            
            setTimeout(() => {
                const username = document.getElementById('loginUsername').value.trim();
                const password = document.getElementById('loginPassword').value;
                
                if (!username || !password) {
                    showNotification('error', 'Login Gagal', 'Harap isi username dan password');
                    hideLoading();
                    return;
                }
                
                if (users[username] && users[username].password === password) {
                    currentUser = username;
                    localStorage.setItem('current_dh_finance_user', username);
                    
                    // Update last login
                    users[username].lastLogin = new Date().toISOString();
                    localStorage.setItem('dh_finance_users', JSON.stringify(users));
                    
                    showMainApp();
                    loadUserData();
                    
                    // Reset form
                    document.getElementById('loginUsername').value = '';
                    document.getElementById('loginPassword').value = '';
                    
                    hideLoading();
                    showNotification('success', 'Login Berhasil', `Selamat datang kembali, ${username}!`);
                } else {
                    showNotification('error', 'Login Gagal', 'Username atau password salah');
                    hideLoading();
                }
            }, 1000);
        }

        function register() {
            showLoading('Mendaftarkan akun...');
            
            setTimeout(() => {
                const username = document.getElementById('registerUsername').value.trim();
                const email = document.getElementById('registerEmail').value.trim();
                const password = document.getElementById('registerPassword').value;
                
                if (!username || !password) {
                    showNotification('error', 'Pendaftaran Gagal', 'Harap isi username dan password');
                    hideLoading();
                    return;
                }
                
                if (username.length < 3) {
                    showNotification('error', 'Pendaftaran Gagal', 'Username minimal 3 karakter');
                    hideLoading();
                    return;
                }
                
                if (password.length < 6) {
                    showNotification('error', 'Pendaftaran Gagal', 'Password minimal 6 karakter');
                    hideLoading();
                    return;
                }
                
                if (users[username]) {
                    showNotification('error', 'Pendaftaran Gagal', 'Username sudah terdaftar');
                    hideLoading();
                    return;
                }
                
                // Initialize user data
                users[username] = {
                    password: password,
                    email: email || '',
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString()
                };
                
                // Initialize user settings with default currency
                if (!userSettings[username]) {
                    userSettings[username] = {
                        currency: 'IDR'
                    };
                }
                
                // Initialize empty transactions for new user
                if (!transactions[username]) {
                    transactions[username] = [];
                }
                
                localStorage.setItem('dh_finance_users', JSON.stringify(users));
                localStorage.setItem('dh_finance_user_settings', JSON.stringify(userSettings));
                localStorage.setItem('dh_finance_transactions', JSON.stringify(transactions));
                
                // Reset form
                document.getElementById('registerUsername').value = '';
                document.getElementById('registerEmail').value = '';
                document.getElementById('registerPassword').value = '';
                
                hideLoading();
                showNotification('success', 'Pendaftaran Berhasil', 'Akun berhasil dibuat! Silakan login dengan akun baru Anda.');
            }, 1000);
        }

        function logout() {
            showLoading('Keluar dari sistem...');
            
            setTimeout(() => {
                if (currentUser && users[currentUser]) {
                    users[currentUser].lastLogin = new Date().toISOString();
                    localStorage.setItem('dh_finance_users', JSON.stringify(users));
                }
                
                currentUser = null;
                localStorage.removeItem('current_dh_finance_user');
                checkLoginStatus();
                hideLoading();
                showNotification('info', 'Logout Berhasil', 'Anda telah logout dari sistem');
            }, 800);
        }

        function checkLoginStatus() {
            const savedUser = localStorage.getItem('current_dh_finance_user');
            if (savedUser && users[savedUser]) {
                currentUser = savedUser;
                showMainApp();
                loadUserData();
            } else {
                showAuthSection();
            }
        }

        function showAuthSection() {
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('currentUser').textContent = 'Belum Login';
        }

        function showMainApp() {
            showLoading('Memuat data...');
            
            setTimeout(() => {
                document.getElementById('authSection').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('currentUser').textContent = currentUser || 'Belum Login';
                loadUserSettings();
                hideLoading();
            }, 1000);
        }

        // Load user-specific settings
        function loadUserSettings() {
            if (!currentUser) return;
            
            // Get user's currency preference
            let userCurrency = 'IDR'; // Default
            
            if (userSettings[currentUser] && userSettings[currentUser].currency) {
                userCurrency = userSettings[currentUser].currency;
            }
            
            // Update currency display
            document.getElementById('currencyLabel').textContent = userCurrency;
            
            // Initialize currency settings with user's preference
            initializeCurrencySettings(userCurrency);
        }

        // Transaction functions
        function toggleProofField() {
            const hasProof = document.getElementById('hasProof').checked;
            const proofContainer = document.getElementById('proofContainer');
            const proofDetails = document.getElementById('proofDetails');
            
            if (hasProof) {
                proofContainer.classList.remove('hidden');
                proofDetails.required = true;
            } else {
                proofContainer.classList.add('hidden');
                proofDetails.required = false;
                proofDetails.value = '';
            }
        }

        function toggleFilterMode() {
            const enableFilter = document.getElementById('enableFilter').checked;
            const filterControls = document.getElementById('filterControls');
            
            if (enableFilter) {
                filterControls.style.display = 'flex';
            } else {
                filterControls.style.display = 'none';
                clearFilter();
            }
        }

        // Fungsi untuk membuka link bukti transfer di tab baru
        function openProofLink(url) {
            if (!url || url === 'Tidak ada bukti transfer') {
                return;
            }
            
            // Validasi URL
            let validUrl = url;
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                validUrl = 'https://' + url;
            }
            
            // Buka langsung di tab baru tanpa alert
            window.open(validUrl, '_blank', 'noopener,noreferrer');
        }

        function addTransaction() {
            if (!currentUser) return;
            
            showLoading('Menyimpan transaksi...');
            
            setTimeout(() => {
                const type = document.getElementById('transactionType').value;
                const amount = parseFloat(document.getElementById('amount').value);
                const description = document.getElementById('description').value.trim();
                const date = document.getElementById('transactionDate').value;
                const hasProof = document.getElementById('hasProof').checked;
                let proofDetails = document.getElementById('proofDetails').value.trim();
                
                if (!amount || amount <= 0) {
                    showNotification('error', 'Transaksi Gagal', 'Harap masukkan nominal yang valid');
                    hideLoading();
                    return;
                }
                
                if (!date) {
                    showNotification('error', 'Transaksi Gagal', 'Harap pilih tanggal transaksi');
                    hideLoading();
                    return;
                }
                
                if (hasProof) {
                    if (!proofDetails) {
                        showNotification('error', 'Transaksi Gagal', 'Harap isi link bukti transfer');
                        hideLoading();
                        return;
                    }
                    
                    // Validasi format URL
                    if (!proofDetails.startsWith('http://') && !proofDetails.startsWith('https://')) {
                        proofDetails = 'https://' + proofDetails;
                    }
                    
                    try {
                        new URL(proofDetails);
                    } catch (e) {
                        showNotification('error', 'Transaksi Gagal', 'Harap masukkan URL yang valid (contoh: https://prnt.sc/abc123)');
                        hideLoading();
                        return;
                    }
                } else {
                    proofDetails = 'Tidak ada bukti transfer';
                }
                
                const transaction = {
                    id: Date.now(),
                    type: type,
                    amount: amount,
                    description: description || 'Tanpa keterangan',
                    date: date,
                    hasProof: hasProof,
                    proofDetails: proofDetails,
                    createdAt: new Date().toISOString()
                };
                
                if (!transactions[currentUser]) {
                    transactions[currentUser] = [];
                }
                
                transactions[currentUser].push(transaction);
                localStorage.setItem('dh_finance_transactions', JSON.stringify(transactions));
                
                // Reset form
                document.getElementById('amount').value = '';
                document.getElementById('description').value = '';
                document.getElementById('hasProof').checked = false;
                document.getElementById('proofDetails').value = '';
                toggleProofField();
                
                loadUserData();
                hideLoading();
                
                const typeText = type === 'income' ? 'Uang Masuk' : 'Uang Keluar';
                showNotification('success', 'Transaksi Berhasil', `${typeText} sebesar ${formatCurrency(transaction.amount, currencies[userSettings[currentUser]?.currency || 'IDR'])} berhasil disimpan!`);
            }, 800);
        }

        function showDeleteModal(transactionId) {
            if (!currentUser) return;
            
            const userTransactions = transactions[currentUser] || [];
            const transaction = userTransactions.find(t => t.id === transactionId);
            
            if (!transaction) return;
            
            transactionToDelete = transactionId;
            
            // Populate modal with transaction details
            const modalDetails = document.getElementById('modalTransactionDetails');
            const currency = currencies[userSettings[currentUser]?.currency || 'IDR'];
            
            modalDetails.innerHTML = `
                <div><strong>Tanggal:</strong> ${formatDateForExport(transaction.date)}</div>
                <div><strong>Jenis:</strong> ${transaction.type === 'income' ? 'Uang Masuk' : 'Uang Keluar'}</div>
                <div><strong>Keterangan:</strong> ${transaction.description}</div>
                <div><strong>Jumlah:</strong> ${formatCurrency(transaction.amount, currency)}</div>
            `;
            
            // Show modal
            document.getElementById('deleteModal').classList.add('active');
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.remove('active');
            transactionToDelete = null;
        }

        function confirmDeleteTransaction() {
            if (!currentUser || !transactionToDelete) return;
            
            showLoading('Menghapus transaksi...');
            
            setTimeout(() => {
                const userTransactions = transactions[currentUser] || [];
                const index = userTransactions.findIndex(t => t.id === transactionToDelete);
                
                if (index !== -1) {
                    const deletedTransaction = userTransactions[index];
                    userTransactions.splice(index, 1);
                    transactions[currentUser] = userTransactions;
                    localStorage.setItem('dh_finance_transactions', JSON.stringify(transactions));
                    
                    loadUserData();
                    closeDeleteModal();
                    
                    // Show notification
                    const currency = currencies[userSettings[currentUser]?.currency || 'IDR'];
                    showNotification('success', 'Transaksi Dihapus', `Transaksi sebesar ${formatCurrency(deletedTransaction.amount, currency)} berhasil dihapus`);
                }
                
                hideLoading();
                transactionToDelete = null;
            }, 800);
        }

        function deleteTransaction(transactionId) {
            showDeleteModal(transactionId);
        }

        function loadUserData() {
            if (!currentUser) return;
            
            const userTransactions = transactions[currentUser] || [];
            updateDashboard(userTransactions);
            renderTransactionList(userTransactions);
            updateFooterInfo(userTransactions);
            updateFilterStatus();
        }

        function updateDashboard(userTransactions) {
            let totalIncome = 0;
            let totalExpense = 0;
            
            userTransactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    totalIncome += transaction.amount;
                } else {
                    totalExpense += transaction.amount;
                }
            });
            
            const balance = totalIncome - totalExpense;
            
            // Get user's currency preference
            let userCurrency = 'IDR';
            if (userSettings[currentUser] && userSettings[currentUser].currency) {
                userCurrency = userSettings[currentUser].currency;
            }
            
            const currency = currencies[userCurrency];
            
            document.getElementById('currentBalance').textContent = 
                formatCurrency(balance, currency);
            document.getElementById('totalIncome').textContent = 
                formatCurrency(totalIncome, currency);
            document.getElementById('totalExpense').textContent = 
                formatCurrency(totalExpense, currency);
        }

        function renderTransactionList(userTransactions) {
            const container = document.getElementById('transactionList');
            
            // Get user's currency preference
            let userCurrency = 'IDR';
            if (userSettings[currentUser] && userSettings[currentUser].currency) {
                userCurrency = userSettings[currentUser].currency;
            }
            
            const currency = currencies[userCurrency];
            
            if (!userTransactions || userTransactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <h3 style="margin-bottom: 10px; color: #64748b;">Belum ada transaksi</h3>
                        <p style="color: #94a3b8;">Tambahkan transaksi pertama Anda menggunakan form di sebelah kiri</p>
                    </div>
                `;
                document.getElementById('transactionCountBadge').textContent = '0';
                return;
            }
            
            // Sort by date (newest first)
            const sortedTransactions = [...userTransactions].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            // Apply filter if active
            let filteredTransactions = sortedTransactions;
            if (currentFilter) {
                filteredTransactions = sortedTransactions.filter(transaction => 
                    transaction.date === currentFilter
                );
            }
            
            // Update transaction count badge
            document.getElementById('transactionCountBadge').textContent = filteredTransactions.length;
            
            // Show only last 10 transactions
            const recentTransactions = filteredTransactions.slice(0, 20);
            
            if (recentTransactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-filter"></i>
                        </div>
                        <h3 style="margin-bottom: 10px; color: #64748b;">Tidak ada transaksi pada tanggal ini</h3>
                        <p style="color: #94a3b8;">Coba pilih tanggal lain atau hapus filter</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = recentTransactions.map(transaction => {
                const hasProof = transaction.hasProof && transaction.proofDetails !== 'Tidak ada bukti transfer';
                const proofClass = hasProof ? 'has-proof' : 'no-proof';
                const displayProof = hasProof ? 
                    (transaction.proofDetails.length > 30 ? 
                     transaction.proofDetails.substring(0, 30) + '...' : 
                     transaction.proofDetails) : 
                    transaction.proofDetails;
                
                // Buat elemen bukti transfer yang dapat diklik
                let proofElement = '';
                if (hasProof) {
                    proofElement = `
                        <a href="${transaction.proofDetails}" 
                           target="_blank"
                           onclick="openProofLink('${transaction.proofDetails}'); return false;"
                           class="proof-badge ${proofClass}"
                           title="Klik untuk membuka bukti transfer di tab baru">
                            <i class="fas ${hasProof ? 'fa-external-link-alt' : 'fa-times-circle'}"></i>
                            ${displayProof}
                        </a>
                    `;
                } else {
                    proofElement = `
                        <span class="proof-badge ${proofClass}">
                            <i class="fas ${hasProof ? 'fa-external-link-alt' : 'fa-times-circle'}"></i>
                            ${displayProof}
                        </span>
                    `;
                }
                
                return `
                <div class="transaction-item" id="transaction-${transaction.id}">
                    <div class="transaction-content">
                        <div style="font-weight: bold; margin-bottom: 8px; font-size: 18px;">
                            ${transaction.description}
                        </div>
                        <div style="font-size: 15px; color: #64748b; margin-bottom: 10px;">
                            <i class="far fa-calendar"></i> 
                            ${formatDate(transaction.date)}
                        </div>
                        <div style="margin-bottom: 10px;">
                            <span class="transaction-type type-${transaction.type}">
                                ${transaction.type === 'income' ? 'Uang Masuk' : 'Uang Keluar'}
                            </span>
                        </div>
                        <div>
                            ${proofElement}
                        </div>
                    </div>
                    <div class="transaction-actions">
                        <button class="delete-btn" onclick="deleteTransaction(${transaction.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="transaction-amount ${transaction.type === 'income' ? 'amount-income' : 'amount-expense'}">
                        ${transaction.type === 'income' ? '+' : '-'} ${formatCurrency(transaction.amount, currency)}
                    </div>
                </div>
                `;
            }).join('');
        }

        function updateFooterInfo(userTransactions) {
            document.getElementById('footerUsername').textContent = currentUser;
            document.getElementById('footerTransactionCount').textContent = userTransactions.length || 0;
        }

        // Filter functions
        function applyFilter() {
            if (!currentUser) return;
            
            showLoading('Menerapkan filter...');
            
            setTimeout(() => {
                const filterDate = document.getElementById('filterDate').value;
                if (!filterDate) {
                    showNotification('warning', 'Filter Gagal', 'Harap pilih tanggal untuk filter');
                    hideLoading();
                    return;
                }
                
                currentFilter = filterDate;
                loadUserData();
                
                hideLoading();
                showNotification('info', 'Filter Diaktifkan', `Menampilkan transaksi pada tanggal ${formatDateForExport(filterDate)}`);
            }, 600);
        }

        function clearFilter() {
            if (currentFilter) {
                showLoading('Reset filter...');
                
                setTimeout(() => {
                    currentFilter = null;
                    document.getElementById('enableFilter').checked = false;
                    document.getElementById('filterControls').style.display = 'none';
                    loadUserData();
                    
                    hideLoading();
                    showNotification('info', 'Filter Dihapus', 'Menampilkan semua transaksi');
                }, 500);
            }
        }

        function updateFilterStatus() {
            const filterStatus = document.getElementById('filterStatus');
            const filterStatusMini = document.getElementById('filterStatusMini');
            const filterMessage = document.getElementById('filterMessage');
            const filterMessageMini = document.getElementById('filterMessageMini');
            
            if (currentFilter) {
                filterStatus.classList.remove('hidden');
                filterStatus.classList.add('filter-active');
                filterMessage.textContent = `Menampilkan transaksi pada tanggal ${formatDateForExport(currentFilter)}`;
                
                filterStatusMini.style.display = 'flex';
                filterMessageMini.textContent = `Filter aktif: ${formatDateForExport(currentFilter)}`;
            } else {
                filterStatus.classList.add('hidden');
                filterStatus.classList.remove('filter-active');
                filterMessage.textContent = 'Menampilkan semua transaksi';
                
                filterStatusMini.style.display = 'none';
            }
        }

        // Export functions
        function exportToExcel() {
            if (!currentUser) return;
            
            showLoading('Mengekspor ke Excel...');
            
            setTimeout(() => {
                const userTransactions = transactions[currentUser] || [];
                
                if (userTransactions.length === 0) {
                    showNotification('warning', 'Ekspor Gagal', 'Tidak ada data transaksi untuk diekspor');
                    hideLoading();
                    return;
                }
                
                // Get user's currency preference
                let userCurrency = 'IDR';
                if (userSettings[currentUser] && userSettings[currentUser].currency) {
                    userCurrency = userSettings[currentUser].currency;
                }
                
                const currencySymbol = currencies[userCurrency].symbol;
                
                // Apply filter if active
                let exportTransactions = userTransactions;
                if (currentFilter) {
                    exportTransactions = userTransactions.filter(transaction => 
                        transaction.date === currentFilter
                    );
                }
                
                // Prepare data for Excel
                const excelData = exportTransactions.map((transaction, index) => ({
                    'No': index + 1,
                    'Tanggal': formatDateForExport(transaction.date),
                    'Jenis': transaction.type === 'income' ? 'Uang Masuk' : 'Uang Keluar',
                    'Keterangan': transaction.description,
                    'Jumlah': `${currencySymbol} ${transaction.amount.toLocaleString('id-ID')}`,
                    'Bukti Transfer': transaction.proofDetails,
                    'Dibuat Pada': formatDateTime(transaction.createdAt)
                }));
                
                // Create worksheet
                const ws = XLSX.utils.json_to_sheet(excelData);
                
                // Create workbook
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Transaksi");
                
                // Generate file name
                const filterSuffix = currentFilter ? `_filter_${currentFilter}` : '';
                const fileName = `dh_finance_transaksi_${currentUser}${filterSuffix}_${new Date().toISOString().slice(0,10)}.xlsx`;
                
                // Save to file
                XLSX.writeFile(wb, fileName);
                
                hideLoading();
                showNotification('success', 'Ekspor Berhasil', `Data telah diekspor ke ${fileName}`);
            }, 800);
        }

        function exportToWord() {
            if (!currentUser) return;
            
            showLoading('Mengekspor ke Word...');
            
            setTimeout(() => {
                const userTransactions = transactions[currentUser] || [];
                
                if (userTransactions.length === 0) {
                    showNotification('warning', 'Ekspor Gagal', 'Tidak ada data transaksi untuk diekspor');
                    hideLoading();
                    return;
                }
                
                // Get user's currency preference
                let userCurrency = 'IDR';
                if (userSettings[currentUser] && userSettings[currentUser].currency) {
                    userCurrency = userSettings[currentUser].currency;
                }
                
                const currencySymbol = currencies[userCurrency].symbol;
                
                // Apply filter if active
                let exportTransactions = userTransactions;
                if (currentFilter) {
                    exportTransactions = userTransactions.filter(transaction => 
                        transaction.date === currentFilter
                    );
                }
                
                // Calculate totals
                let totalIncome = 0;
                let totalExpense = 0;
                
                exportTransactions.forEach(transaction => {
                    if (transaction.type === 'income') {
                        totalIncome += transaction.amount;
                    } else {
                        totalExpense += transaction.amount;
                    }
                });
                
                const balance = totalIncome - totalExpense;
                
                // Create Word document content
                let wordContent = `
                <html xmlns:o='urn:schemas-microsoft-com:office:office' 
                      xmlns:w='urn:schemas-microsoft-com:office:word' 
                      xmlns='http://www.w3.org/TR/REC-html40'>
                <head>
                    <meta charset='utf-8'>
                    <title>Laporan Keuangan DH Finance</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 40px; }
                        h1 { color: #1e3a8a; border-bottom: 2px solid #1d4ed8; padding-bottom: 10px; }
                        h2 { color: #1e3a8a; margin-top: 30px; }
                        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
                        th { background-color: #dbeafe; color: #1e3a8a; padding: 12px; text-align: left; border: 1px solid #93c5fd; }
                        td { padding: 10px; border: 1px solid #93c5fd; }
                        .income { color: #10b981; }
                        .expense { color: #ef4444; }
                        .summary { background-color: #f8fafc; padding: 20px; border-radius: 10px; margin-top: 30px; }
                        .footer { margin-top: 40px; font-size: 12px; color: #64748b; text-align: center; }
                    </style>
                </head>
                <body>
                    <h1>Laporan Keuangan DH Finance</h1>
                    <p><strong>Pengguna:</strong> ${currentUser}</p>
                    <p><strong>Tanggal Ekspor:</strong> ${new Date().toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                    <p><strong>Mata Uang:</strong> ${userCurrency} (${currencySymbol})</p>
                    ${currentFilter ? `<p><strong>Filter Tanggal:</strong> ${formatDateForExport(currentFilter)}</p>` : ''}
                    
                    <h2>Ringkasan</h2>
                    <div class="summary">
                        <p><strong>Total Uang Masuk:</strong> <span class="income">${currencySymbol} ${formatNumber(totalIncome)}</span></p>
                        <p><strong>Total Uang Keluar:</strong> <span class="expense">${currencySymbol} ${formatNumber(totalExpense)}</span></p>
                        <p><strong>Saldo Saat Ini:</strong> <strong>${currencySymbol} ${formatNumber(balance)}</strong></p>
                        <p><strong>Jumlah Transaksi:</strong> ${exportTransactions.length}</p>
                    </div>
                    
                    <h2>Detail Transaksi</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Tanggal</th>
                                <th>Jenis</th>
                                <th>Keterangan</th>
                                <th>Jumlah</th>
                                <th>Bukti Transfer</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                // Add transaction rows
                exportTransactions.forEach((transaction, index) => {
                    const rowClass = transaction.type === 'income' ? 'income' : 'expense';
                    wordContent += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${formatDateForExport(transaction.date)}</td>
                            <td>${transaction.type === 'income' ? 'Uang Masuk' : 'Uang Keluar'}</td>
                            <td>${transaction.description}</td>
                            <td class="${rowClass}">${transaction.type === 'income' ? '+' : '-'} ${currencySymbol} ${formatNumber(transaction.amount)}</td>
                            <td>${transaction.proofDetails}</td>
                        </tr>
                    `;
                });
                
                wordContent += `
                        </tbody>
                    </table>
                    
                    <div class="footer">
                        <p>&copy; ${new Date().getFullYear()} DH Finance - Aplikasi Manajemen Keuangan Pribadi</p>
                        <p>Dokumen ini dibuat secara otomatis oleh sistem DH Finance</p>
                    </div>
                </body>
                </html>
                `;
                
                // Create blob and download
                const blob = new Blob(['\ufeff', wordContent], {
                    type: 'application/msword'
                });
                
                const filterSuffix = currentFilter ? `_filter_${currentFilter}` : '';
                const fileName = `dh_finance_transaksi_${currentUser}${filterSuffix}_${new Date().toISOString().slice(0,10)}.doc`;
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                
                link.href = url;
                link.download = fileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                hideLoading();
                showNotification('success', 'Ekspor Berhasil', `Data telah diekspor ke ${fileName}`);
            }, 800);
        }

        // Currency functions
        function initializeCurrencySettings(userCurrency = null) {
            const container = document.getElementById('currencyGrid');
            container.innerHTML = '';
            
            const currentUserCurrency = userCurrency || (userSettings[currentUser]?.currency || 'IDR');
            
            Object.entries(currencies).forEach(([code, data]) => {
                const isActive = currentUserCurrency === code;
                const currencyItem = document.createElement('div');
                currencyItem.className = `currency-item ${isActive ? 'active' : ''}`;
                currencyItem.innerHTML = `
                    <div style="font-size: 32px; font-weight: bold; margin-bottom: 10px;">${data.symbol}</div>
                    <div style="font-weight: 600; margin: 8px 0; font-size: 18px;">${code}</div>
                    <div style="font-size: 15px; color: ${isActive ? '#1e3a8a' : '#64748b'};">
                        ${data.name}
                    </div>
                `;
                currencyItem.onclick = () => setCurrency(code);
                container.appendChild(currencyItem);
            });
        }

        function setCurrency(currencyCode) {
            if (!currentUser) return;
            
            showLoading('Mengubah mata uang...');
            
            setTimeout(() => {
                // Update user's currency preference
                if (!userSettings[currentUser]) {
                    userSettings[currentUser] = {};
                }
                userSettings[currentUser].currency = currencyCode;
                localStorage.setItem('dh_finance_user_settings', JSON.stringify(userSettings));
                
                // Update UI
                document.getElementById('currencyLabel').textContent = currencyCode;
                initializeCurrencySettings(currencyCode);
                loadUserData();
                hideLoading();
                
                // Add visual feedback
                const currencyItem = document.querySelector(`.currency-item.active`);
                if (currencyItem) {
                    currencyItem.classList.add('selected');
                    setTimeout(() => {
                        currencyItem.classList.remove('selected');
                    }, 500);
                }
                
                showNotification('success', 'Mata Uang Diubah', `Mata uang berhasil diubah ke ${currencyCode}`);
            }, 800);
        }

        // Utility functions
        function formatCurrency(amount, currency) {
            return `${currency.symbol} ${formatNumber(amount)}`;
        }

        function formatNumber(number) {
            return number.toLocaleString('id-ID', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 2
            });
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function formatDateForExport(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function formatDateTime(dateTimeString) {
            const date = new Date(dateTimeString);
            return date.toLocaleString('id-ID', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Initialize with sample data for demo user only
        if (!localStorage.getItem('dh_finance_initialized')) {
            const demoUser = 'demo';
            users[demoUser] = { 
                password: 'demo123', 
                email: 'demo@dhfinance.com',
                createdAt: new Date().toISOString(),
                lastLogin: new Date().toISOString()
            };
            
            // Initialize user settings for demo
            userSettings[demoUser] = {
                currency: 'IDR'
            };
            
            // Add sample transactions only for demo user
            const sampleTransactions = [
                {
                    id: 1,
                    type: 'income',
                    amount: 1000000,
                    description: 'Gaji Bulanan',
                    date: new Date().toISOString().split('T')[0],
                    hasProof: true,
                    proofDetails: 'https://prnt.sc/fk8Ctptkwt3',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    type: 'expense',
                    amount: 125000,
                    description: 'Belanja Bulanan',
                    date: new Date().toISOString().split('T')[0],
                    hasProof: false,
                    proofDetails: 'Tidak ada bukti transfer',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 3,
                    type: 'income',
                    amount: 500000,
                    description: 'Transfer dari Klien',
                    date: new Date().toISOString().split('T')[0],
                    hasProof: true,
                    proofDetails: 'https://example.com/bukti-transfer.jpg',
                    createdAt: new Date().toISOString()
                }
            ];
            
            transactions[demoUser] = sampleTransactions;
            
            localStorage.setItem('dh_finance_users', JSON.stringify(users));
            localStorage.setItem('dh_finance_user_settings', JSON.stringify(userSettings));
            localStorage.setItem('dh_finance_transactions', JSON.stringify(transactions));
            localStorage.setItem('dh_finance_initialized', 'true');
        }
    </script>
</body>
</html>